<!DOCTYPE html>
<html>
<head>
    <title>AR Photo Booth</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
       
        /* The Snap Button */
        #snap-button {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 80px;
            background-color: rgba(255, 255, 255, 0.5);
            border: 4px solid white; border-radius: 50%;
            z-index: 10; cursor: pointer;
        }
        #snap-button:active { background-color: white; }
        /* The "Photo Preview" Overlay (Hidden by default) */
        #preview-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 20;
            flex-direction: column; align-items: center; justify-content: center;
        }
        #preview-img {
            width: 90%; max-height: 80%; border: 5px solid white; border-radius: 10px;
        }
        #close-btn {
            margin-top: 20px; padding: 10px 30px; background: white; color: black;
            border: none; border-radius: 20px; font-weight: bold; font-size: 16px;
        }
        .instructions { color: white; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div id="snap-button"></div>
    <div id="preview-overlay">
        <div class="instructions">Long-press image to save!</div>
        <img id="preview-img" src="">
        <button id="close-btn" onclick="closePreview()">Close & Retake</button>
    </div>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;" renderer="logarithmicDepthBuffer: true; preserveDrawingBuffer: true;" vr-mode-ui="enabled: false">
       
        <a-marker preset="hiro" size="0.2">
           
            <a-box position="0 0.5 0" color="yellow" opacity="0.5" scale="1 1 1"></a-box>
            <a-image
                src="https://raw.githubusercontent.com/Mcwiggles/TCCSOpenDay/main/characters.png"
                material="transparent: true; alphaTest: 0.5;"
                position="0 0 0.01"
                rotation="0 0 0"
                width="3.22"
                height="1.8">
            </a-image>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
    <script>
        // Wait for the scene to load and video to be ready
        const scene = document.querySelector('a-scene');
        scene.addEventListener('loaded', function () {
            const video = document.querySelector('video');
            // Ensure video is ready (metadata loaded)
            video.addEventListener('loadedmetadata', function () {
                document.getElementById('snap-button').addEventListener('click', function () {
                    // Get the AR 3D layer (canvas)
                    const canvas3D = scene.canvas;
                    // Create a temporary canvas to merge
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = video.videoWidth;
                    tempCanvas.height = video.videoHeight;
                    const ctx = tempCanvas.getContext('2d');
                    // Draw Video (Background)
                    ctx.drawImage(video, 0, 0, tempCanvas.width, tempCanvas.height);
                    // Draw AR Object (Foreground)
                    ctx.drawImage(canvas3D, 0, 0, tempCanvas.width, tempCanvas.height);
                    // Convert to Image URL and show in overlay
                    const dataURL = tempCanvas.toDataURL('image/png');
                    document.getElementById('preview-img').src = dataURL;
                    document.getElementById('preview-overlay').style.display = 'flex';
                });
            });
        });
        function closePreview() {
            document.getElementById('preview-overlay').style.display = 'none';
        }
    </script>
</body>
</html>
